<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SlopPG: Searching for the Stolen Slop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      color: limegreen;
      font-family: monospace;
      font-size: 2.5vw;
      overflow-x: hidden;
      text-align: center;
    }

    #game {
      white-space: pre;
      margin: 0 auto;
      display: inline-block;
    }

    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
      user-select: none;
    }

    .control-row {
      display: flex;
      justify-content: center;
      margin: 5px;
    }

    .btn {
      background: #111;
      color: limegreen;
      border: 2px solid limegreen;
      font-size: 6vw;
      width: 60px;
      height: 60px;
      margin: 4px;
      border-radius: 10px;
    }

    @media (min-width: 768px) {
      body {
        font-size: 16px;
      }
      .btn {
        font-size: 24px;
        width: 60px;
        height: 60px;
      }
    }
  </style>
</head>
<body>

<pre id="game"></pre>

<div class="controls">
  <div class="control-row">
    <button class="btn" onclick="handleMove('ArrowUp')">↑</button>
  </div>
  <div class="control-row">
    <button class="btn" onclick="handleMove('ArrowLeft')">←</button>
    <button class="btn" onclick="handleMove('ArrowDown')">↓</button>
    <button class="btn" onclick="handleMove('ArrowRight')">→</button>
  </div>
</div>

<script>
const TILE_W = 3;
const TILE_H = 3;
const GRID_W = 16;
const GRID_H = 8;

const EMPTY_TILE = [
  '   ',
  '   ',
  '   '
];

const WALL_TILE = [
  '###',
  '###',
  '###'
];

const SLOP_TILE = [
  '~~ ',
  '   ',
  '   '
];

const pigSprite = [
  '(°ᴥ°)',
  '/|@|\\',
  '/ \\ '
];

const trooperSprite = [
  '[¬_¬]',
  '/|F|\\',
  '/ \\ '
];

let map = [];
let slops = [];

let jame = { x: 1, y: 1 };  // renamed pig
let trooper = { x: GRID_W - 3, y: GRID_H - 3 };  // renamed farmer

function createEmptyMap() {
  map = [];
  slops = [];
  for (let y = 0; y < GRID_H; y++) {
    let row = [];
    for (let x = 0; x < GRID_W; x++) {
      if (x === 0 || y === 0 || x === GRID_W - 1 || y === GRID_H - 1 || Math.random() < 0.06) {
        row.push([...WALL_TILE]);
      } else {
        row.push([...EMPTY_TILE]);
      }
    }
    map.push(row);
  }

  // Add slops
  for (let i = 0; i < 6; i++) {
    let sx, sy;
    do {
      sx = Math.floor(Math.random() * (GRID_W - 2)) + 1;
      sy = Math.floor(Math.random() * (GRID_H - 2)) + 1;
    } while (isWall(sx, sy));
    slops.push({ x: sx, y: sy });
    map[sy][sx] = [...SLOP_TILE];
  }
}

function isWall(x, y) {
  return map[y][x][0].includes('#');
}

function drawSprite(x, y, sprite) {
  for (let i = 0; i < sprite.length; i++) {
    map[y + i][x] = sprite[i].padEnd(3, ' ').split('');
  }
}

function clearSprite(x, y) {
  for (let i = 0; i < TILE_H; i++) {
    map[y + i][x] = [...EMPTY_TILE[i]];
  }
}

function render() {
  let display = map.map(row => row.map(tile => [...tile]));

  slops.forEach(slop => {
    display[slop.y][slop.x] = [...SLOP_TILE[0]];
  });

  drawSprite(jame.x, jame.y, pigSprite);
  drawSprite(trooper.x, trooper.y, trooperSprite);

  let output = '';
  for (let y = 0; y < GRID_H; y++) {
    for (let line = 0; line < TILE_H; line++) {
      for (let x = 0; x < GRID_W; x++) {
        output += map[y][x][line] || '   ';
      }
      output += '\n';
    }
  }

  output += `\nSlops remaining: ${slops.length}`;
  output += `\nYou are Jame, the Pig Warlock.`;
  output += `\nAvoid the FDA VAX ENFORCEMENT TROOPER!`;

  document.getElementById('game').textContent = output;
}

function tryMove(character, dx, dy) {
  const newX = character.x + dx;
  const newY = character.y + dy;

  if (newX < 1 || newY < 1 || newX >= GRID_W - 1 || newY >= GRID_H - 1) return;
  if (isWall(newX, newY)) return;

  clearSprite(character.x, character.y);
  character.x = newX;
  character.y = newY;
}

function moveTrooperTowardJame() {
  const dx = Math.sign(jame.x - trooper.x);
  const dy = Math.sign(jame.y - trooper.y);
  tryMove(trooper, dx, dy);
}

function checkSlopCollection() {
  slops = slops.filter(slop => !(slop.x === jame.x && slop.y === jame.y));
  if (slops.length === 0) {
    alert("Jame has reclaimed all the stolen slop! VICTORY!");
    createEmptyMap();
    render();
  }
}

function checkTrooperCatch() {
  if (jame.x === trooper.x && jame.y === trooper.y) {
    alert("The FDA VAX ENFORCEMENT TROOPER has caught Jame! Game Over.");
    createEmptyMap();
    render();
  }
}

function handleMove(key) {
  let moved = false;
  switch (key) {
    case 'ArrowUp': tryMove(jame, 0, -1); moved = true; break;
    case 'ArrowDown': tryMove(jame, 0, 1); moved = true; break;
    case 'ArrowLeft': tryMove(jame, -1, 0); moved = true; break;
    case 'ArrowRight': tryMove(jame, 1, 0); moved = true; break;
  }

  if (moved) {
    checkSlopCollection();
    moveTrooperTowardJame();
    checkTrooperCatch();
    render();
  }
}

document.addEventListener('keydown', (e) => handleMove(e.key));

createEmptyMap();
render();
</script>

</body>
</html>
